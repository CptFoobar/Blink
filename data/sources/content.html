<html>
<head>
	<title>Blink - Manage Content</title>
	<meta charset="UTF-8" />
	<link rel="stylesheet" type="text/css" href="css/tab.css" />
	<link rel="stylesheet" type="text/css" href="css/fonts.css" />
	<link rel="stylesheet" type="text/css" href="css/component.css" />
	<link rel="stylesheet" type="text/css" href="css/normalize.css" />
	<link rel="stylesheet" type="text/css" href="css/materialize.css" />
	<link rel="stylesheet" type="text/css" href="font-awesome/css/font-awesome.min.css" />


	<script src="js/contentFiller.js"></script>
	<script src="js/jquery-1.11.3.js"></script>
	<script src="js/materialize.js"></script>
    <script type="text/javascript">
    	var newFeed = [];
    	$(function() { // wait for the DOM to be ready
   			$('#checkboxes').submit(function() {
   				var x = 0;
    			$('#checkboxes').children('p').each(function(i) {
    				var id = 'feed' + i;
    				var lbl = $('#' + 'label' + i);
    				var l = lbl.attr('data-link');
    				var n = lbl.text();
    				var w = false;
    				if($('#' + id).prop("checked") == true) w = true;
    				var feedItem = {"name" : n, "link" : l, "wanted" : w};
    				newFeed.push(feedItem);
    			});
    			window.postMessage(newFeed, "resource://blink/data/sources/content.html");
    			alert("Your preferences have been saved. Close this window and continue your browsing. Have a good day :)");
    		});
		});
    </script>

</head>
<body>
	<div id="st-container" class="st-container">
		<nav class="st-menu st-effect-1" id="menu">
			<h2 style="cursor: default;">Blink</h2>
			<ul>
				<li><a href="tab.html" onclick="hideNavD()"><i class="fa fa-home fa-lg"></i>&nbsp;&nbsp;Home</a></li>
 				<li><a href="#top" onclick="hideNavD()"><i class="fa fa-pencil fa-lg"></i>&nbsp;&nbsp;Edit Content</a></li> 
<!--				<li><a href="#" onclick="hideNavD()"><i class="fa fa-cogs fa-lg"></i>&nbsp;&nbsp;Settings</a></li> -->
				<li><a href="help.html" onclick="hideNavD()"><i class="fa fa-question-circle fa-lg"></i>&nbsp;&nbsp;Help</a></li>
				<li><a href="#aboutModal" onclick="about()" class="modal-trigger"><i class="fa fa-info fa-lg"></i>&nbsp;&nbsp;About</a></li>
			</ul>
		</nav>

		<div class="st-content"><!-- this is the wrapper for the content -->
			<div class="st-content-inner"><!-- extra div for emulating position:fixed of the menu -->
				<div class="top" id="top">
						<span data-effect="st-effect-1" id="toggleMenuBtn" class="navButton">
							<i class="fa fa-bars"></i>
						</span>
						<span class="title-blink"> Blink </span>
				</div><!-- /top -->
				<!-- Cards: This is how we roll -->
				<div class="row">
					<div class="col s12 m12 l12">
						<div class="card yellow lighten-5">
							<div class="card-content blue-grey-text text-darken-1" style="text-align: center;">
								<span class="card-title flow-text blue-grey-text text-darken-3"
								style="font-size: 30px;"><i class="fa fa-pencil"></i>&nbsp;&nbsp;&nbsp;&nbsp;Manage your feed</span>
								 <form id="checkboxes" style="margin-left: 250px;">
    								<br />
								</form>
							</div>
						</div>
					</div>
				</div> 
			</div><!-- /st-content-inner -->
		</div><!-- /st-content -->
	</div> <!-- /st-container -->

	<!-- Modal Structure -->
	<div id="aboutModal" class="modal">
		<div class="modal-content">
			<h4>About Blink</h4>
			<p style="font-size: 20px"> Blink is a new tab replacement add-on for Mozilla Firefox. It turns your dull boring new tab into a refreshing news feed. You can see articles from various tech blogs like TechCrunch, Engadget, Gizmodo and LifeHacker.
			<p style="font-size: 17px"> This add-on a side-project by <a href="http://taleofatiger.blogspot.in/" target="_blank">Sidhant Sharma</a>. It's free and Open Source (check it out on <a href="https://github.com/TigerKid001/Blink" target="_blank">Github</a>).</p>
			
			<a href="http://madewithlove.org.in" target="_blank" style="font-size:14px;">Made with <span style="color: #f7403a">&hearts;</span> in India</a>
		</div>
		<div class="modal-footer">
			<a href="#top" class="waves-effect waves-green btn-flat orange-text text-darken-3" onclick="closeAbout()">Got It</a>
		</div>
	</div>

	<!-- Scripts to add animations and onclicks -->
	<script src="js/classie.js"></script>
	<script src="js/sidebarEffects.js"></script>
	<script type="text/javascript">
		$('a[href*=#]:not([href=#])').click(function() {
			if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'') && location.hostname == this.hostname) {
				var target = $(this.hash);
				target = target.length ? target : $('[name=' + this.hash.slice(1) +']');
				if (target.length) {
					$('*').animate({
						scrollTop: target.offset().top
					}, 2000);
					return false;
				}
			}
		});
		var about = function() { 
			hideNavD();
			$('#aboutModal').openModal();
		}

		var closeAbout = function() {
			$('#aboutModal').closeModal();
		}
  	</script>
	<script type="text/javascript">
			var check = "checked='checked'";
			var CB_TEMPLATE = "<p>" + 
    							"<input type='checkbox' id='feed%index%' %chkd%/>" +
    								"<label class='option blue-grey-text text-darken-1' " +
    									"for='feed%index%' data-link='%link%' id='label%index%'>%name%</label>" + 
    							"</p><br />"

    		var SUBMIT_BUTTON = "<button class='btn waves-effect waves-light' " + 
    								"type='submit' name='action'>Looks Great!&nbsp;&nbsp;" + 
    									"<i class='fa fa-paper-plane'></i>" + 
  								"</button>";
			var parser = new DOMParser();
			var form = document.getElementById('checkboxes');
			var addOptions = function(feedList) {	
				for(var i = 0; i < feedList.length; i++) {
					var option = CB_TEMPLATE;
					option = option.replace("%index%", i);
					option = option.replace("%index%", i);
					option = option.replace("%index%", i);
					option = option.replace("%link%", feedList[i].link)
					option = option.replace("%name%", feedList[i].name);
					if(feedList[i].wanted)
						option = option.replace("%chkd%", check);
					else
						option = option.replace("%chkd%", "");
					var doc = parser.parseFromString(option, "text/html");
					form.appendChild(doc.body.firstChild);
					form.appendChild(document.createElement('br'));
				}
			}
			// Listen for feedPrefs
			window.addEventListener('message', function(event) {
    		addOptions(event.data);
			var btn = parser.parseFromString(SUBMIT_BUTTON, "text/html");
			form.appendChild(btn.body.firstChild);
      		}, false);
	</script>
</body>
</html>
